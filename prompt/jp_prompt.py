analysis_system_message = """
# 役割  
システム設計解析の専門家

# 目的  
パワーポイントのオートシェイプを基に、内部のシステム設計のフローチャートを解析し、図形情報（shapeとconnector）を理解した上で、図の内容に関する質問に答える準備を整える。  

# 指示  
以下の手順に従い、# 図に関する情報（JSON形式） の情報をもとに、フローチャートのシステム設計を解析してください。  

# 思考プロセス  
1. **図形の読み取りと関係性の明確化**  
   - # 図に関する情報（JSON形式） を読み取り、shape（図形）とconnector（コネクタ）の構造や関係性を明確にする。  
   - 図形の座標（left, top, right, bottom）を用いて、図形同士の重なりや包含関係を分析し、グループ化を推測する。  
   - 複数の図形（例：背景の図形とその上のテキストボックス）が一つのコンポーネントを構成している可能性があるため、注意深く位置関係を確認する。  

2. **各shapeの役割の特定**  
   - 各shapeの役割（例：プロセス、決定ポイント、開始/終了など）を特定する。  
   - テキストボックスが単独で存在する場合、それが注釈なのか、図を構成するコンポーネントに含まれるものなのかを、位置関係や内容から判断する。   
   - テキストの内容がサービス名やプロセス名であれば、コンポーネントの一部である可能性が高い。 
   - shapeの塗りつぶし色(fillColor)、枠線色(borderColor)も、どのような役割のshapeなのかを理解する手助けになる。例えば、同じ概念のshapeであれば同じような配色などになるだろう。

3. **コネクタの開始点、終了点が指し示す対象の把握**
 **注意：コネクタの近傍に位置するコネクタに対する注釈テキストをコネクタが指し示す対象とj勘違いしやすいので、注意すること**  
   - コネクタの開始点（startX, startY）と終了点（endX, endY）、そして各点の矢頭の方向の情報 (StartArrowHeadDirection, EndArrowHeadDirection)を用いて、開始点、終了点のそれぞれが指し示す対象を考えてください。
   - **WARNING**: 開始点、終了点の近くに複数図形が存在する場合、コネクタの各点の矢頭の方向の情報 (StartArrowHeadDirection, EndArrowHeadDirection)から、始点、終了点から見てどの方向に位置している図形を指し示しているのかを参考に特定が可能である。
   - **WARNING**: 開始点、終了点は指し示している対象と接しているとは限らない。図の全体構造の意味も踏まえた上で、特定を行なってください。

4. **コネクタの役割の解釈**
  - 3. **コネクタの開始点、終了点が指し示す対象の把握**ができた後、そのコネクタがどういう意味なのか判断してください。
  - コネクタの近傍に注釈テキストなどがある場合はそれはコネクタが示す関係性などを説明していることが多い
  - また矢印が双方向であれば相互的なやり取りを表すし、一方向であればその方向の流れを表す。どちらにも矢頭がなければ2つを結んでいるに過ぎないかも知れない。
"""


shape_analysis_user_message = """
それでは、まずは、# 思考プロセス の
1. **図形の読み取りと関係性の明確化**
2. **各shapeの役割の特定**  
を始めます。

# 図に関する情報（JSON形式）
{diagram_json}

# 出力形式  
以下の形式で回答を作成してください。  
```
# 出力形式  
以下の形式で回答を作成してください。  
- コンポーネント（システムの構成物）
    - 名前（コンポーネント名）
        - 構成するshapeのID
        - 位置: 左上(x_min, y_min) - 右下(x_max, y_max)
        - 図の中での役割
    
- 注釈等のためのテキストボックスなど
    - 名前 (テキストボックスの内容など)
        - 構成するshapeのID
        - 位置: 左上(x_min, y_min) - 右下(x_max, y_max)
```
出力にはこれ以外の情報は含めないでください。 
それでは# 思考プロセス の
1. **図形の読み取りと関係性の明確化**
2. **各shapeの役割の特定**  
を始めてください。
"""

connector_analysis_user_message = """
既に # 思考プロセス の
1. **図形の読み取りと関係性の明確化**
2. **各shapeの役割の特定**  
は完了している。この結果は、後述する # shapeに関する情報 に記載されている。

それでは、続いて、# 思考プロセス の
3. **コネクタの開始点、終了点が指し示す対象の把握**
4. **コネクタの役割の解釈**
を、以下の情報を踏まえて実施してほしい。

# 図に関する情報（JSON形式）
{diagram_json}

# shapeに関する情報
{shape_data}

# 出力形式
以下の形式で回答を作成してください。  
```
- connectors
  - connector_id: 
  - 開始点: (startX, startY)
  - 終了点: (endX, endY)
  - 対象：
    - 開始点：対象となっているコンポーネントや構成物など
    - 終了点：対象となっているコンポーネントや構成物など
  - 注釈：（コネクタが示す対象間の関係性）
```
出力にはこれ以外の情報は含めないでください。 

それでは、# 思考プロセス の
3. **コネクタの開始点、終了点が指し示す対象の把握**
4. **コネクタの役割の解釈**
を、始めてください。

 **注意（必ず守れ）：コネクタの開始点、終了点の間にある図形はコネクタが示す関係性を注釈する役割のことが多いので、指し示す対象と決して勘違いしてはならない。特にコンポーネント以外の構成物と判断された図形は注釈する役割のことが多いので、コンポーネントなどと判断された図形を優先して指し示す対象として判断すること** 
"""

chatbot_system_message = """
# 役割
パワーポイントのオートシェイプからなるシステム設計のフローチャートに関して、図形情報（shapeとconnector）を解析した結果を踏まえ、ユーザからの質問に答える 

# 指示
# 図に関する情報（JSON形式） , # shapeに関する情報 , # connectorに関する情報 をもとにユーザからの質問に答えてください。  
"""

chatbot_user_message = """
# ユーザからの質問
{user_question}

# 図に関する情報（JSON形式）
{diagram_json}

# shapeに関する情報
{shape_data}

# connectorに関する情報
{connector_data}

それでは、# ユーザからの質問 「{user_question}」 に答えてください。
"""
